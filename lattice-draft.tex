\documentclass[hoptionsi,review,format=sigplan]{acmart}
\usepackage{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 
%\geometry{landscape}                		% Activate for rotated page geometry
%\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex		
\usepackage{amssymb}

\newtheorem*{remark}{Remark}

\newtheorem*{corollary}{Corollary}

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

%SetFonts

%SetFonts

%------------------------------------------------
%            Symbols in "mathcal"
%------------------------------------------------
\newcommand{\Mcc}{\mathcal{M}}
\newcommand{\Wc}{\mathcal{W}}
\newcommand{\Oc}{\mathcal{O}}
\newcommand{\Pc}{\mathcal{P}}
\newcommand{\Jc}{\mathcal{J}}
\newcommand{\Cc}{\mathcal{C}}


\title[Idempotent Distributive Lattice Completion]{The Idempotent Distributive Lattice Completion of a (finite) Partial Order and Some Applications}
\author{Gershom Bazerman}
\affiliation{Awake Security}
\author{Raymond Puzio}
\affiliation{Albert Einstein Institute}

%\date{}							% Activate to display a given date or no date

\begin{abstract}
We introduce a construction, \(\Mcc\), which yields the idempotent distributive lattice completion of a partially ordered set, via an embedding that preserves all existing meets and joins. In fact, \(\Mcc\) is the initial such morphism; i.e. any other morphism preserving existing meets and joins factors through this embedding, followed by a unique homomorphism of distributive lattices. This completion induces an relationship between finitary posets and finitary distributive lattices which is distinct from the classic Birkhoff duality, and can also be understood locale-theoretically. Further, we introduce what we call Dependency Structures with Choice, which arise naturally in computer science applications and are related to the semantics of concurrent computation. Such structures determine reachability posets, and the application of \(\Mcc\) to such posets yields their Merkle-tree. Finally, we examine a natural covering relation of Versions emerging from DSCs, and describe how any Version Parameterization of a DSC in turn induces a nucleus in the locale generated by the application of \(\Mcc\), and explore some consequences in the logic of dependency representation and solving.

\end{abstract}

\begin{document}
\maketitle

\section{Introduction}

Birkhoff duality stands at the foundation of the theory of distributive lattices. It establishes an isomorphism between finite partial orders and finite distributive lattices in one direction by taking the join-irreducible elements of a distributive lattice, and in the other by looking at all downwardly-closed sets of a partial order. This extends to an isomorphism of categories, with monotone (order-preserving) functions between partial orders corresponding to homomorphisms between distributive lattices. Necessarily, neither operation considered in this duality is idempotent. In particular, since distributive lattices are already partial orders, we can take their downsets repeatedly, Each time, new elements are generated. The object of interest in this paper is another embedding of partial orders into distributive lattices, which is idempotent. The motivation behind this is locale-theoretic: in the finitary case, distributive lattices can be seen as representing the frame of opens of a topological space, and hence provide a bridge between topological and logical/algebraic views of a mathematical object. We wish to take a structure that is, depending on the perspective, almost logical, or almost spatial, and endow it with the minimum extra structure necessary such that it yields a satisfactory internal logic, or, alternatively, such that it can be studied by traditional topological methods. It turns out that such a completion provides a window onto a familiar structure in modern Computer Science -- the Merkle-tree.

In section 2, we introduce the main result of the paper, the idempotent distributive lattice completion, and consider it from the standpoints of order theory, category theory, and locale theory. While basic knowledge of category theory terminology is presumed, this material is otherwise self-contained, with necessary terms defined and and prerequisite facts introduced. In section 3, we turn to applications, introducing dependency structures with choice, and discussing their relation to other structures in computer science, as well as the problems they set out to model, then relating them back to the distributive lattice completion, and exploring some consequences of this connection. In particular, we see how this allows certain covering-relation-like constructions in dependency structures to be viewed as "really" topological in the image of the completion, and the logical implications therein. Finally, we conclude with a discussion of related and future work. For convenience, and in accord with the goas we seek to accomplish, everything in sight in this paper is done in the finitary case. Many results may generalize to the infinite case, or have infinitary analogues, but we consider that future work.

\section{The Idempotent Distributive Lattice Completion}

We introduce here some basic facts and notation regarding order theory, lattices, and locales. The material through Birkhoff's theorem is made use of immediately. The subsequent material discusses locale theory and will be made use of slightly later. [Cite Priestly! then for locales cite...]  [Cite Johnstone, M\&M, Vickers!]

A \textbf{partially ordered set} or poset, \(P\) is a set equipped with a partial order relation \(\le\), which is transitive,  reflexive, and antisymmetric (i.e. for which \( a \le b \mathbin{\&\&} b \le a \implies a = b\)). A (homo)morphism of posets is an monotone (order-preserving) function on their elements, and with such morphisms posets form the category \(Pos\) and finite posets form the subcategory \(FinPos\). Two posets are equivalent when there exist morphisms \(f, g\) between them such that \(f \odot g = id\) and \(g \odot f = id\), i.e. when they are equivalent as objects of \(Pos\). We note that all posets have a standard partial order on them such that \(P \le Q\) when there exists an order-preserving embedding \(P \rightarrow Q\).

A \textbf{lattice}, \(L\) is partially ordered set for which every two elements have a unique greatest lower bound, their \textbf{meet} (\(\wedge\)) and a unique least upper bound, their \textbf{join} (\(\vee\)). The join and meet operations of a lattice are necessarily commutative, associative, and idempotent. A (homo)morphism of distributive lattices is a morphism of posets which also preserves meets and joins. A \textbf{join-semilattice} \textbf{meet-semilattice} are posets that respectively have all joins or all meets. A \textbf{complete lattice} is a lattice which has joins and meets of infinitary as well as finitary collections of elements. We write \(\bigwedge\) and \(\bigvee\) for the meet and join operations as applied to an entire set of elements. By abuse of notation, we also may write, e.g., \(x \vee S\) where \(x\) is an element of a poset and \(S\) is a set of elements, to indicate the lifting of application of the unary operation \(x \vee -\) to every element in the set.

A \textbf{distributive lattice}, is a lattice satisfying the additional property that for all \(x, y, z\) in \(L\), \(x \vee (y \wedge z) = (x \vee y) \wedge (x \vee z)\). It is easy to verify that if this condition (join distributing over meet) is satisfied, then the dual condition (meet distributing over join) is also satisfied.  Lattice homomorphisms between distributive lattices are necessarily distributive lattice homomorphisms, and with such morphisms distributive lattices form the category \(DLat\) and finite distributive lattices form the subcategory \(FinDLat\). In \(FinDLat\), all lattices necessarily have a unique top and bottom element (i.e. are bounded). As such, we require morphisms in \(FinDLat\) to also preserve top and bottom elements as the nullary join and meet (i.e. to be homomorphisms of bounded lattices).

A \textbf{join-irreducible} element of a poset is an element \(x\) such that no collection of elements not including \(x\) has \(x\) as its join. The operation \(\Jc(P)\) sends a poset (or a lattice viewed as a poset) to the sub-poset of its join-irreducible elements, sharing the same order relation. An intuition that this lends itself to is that join-irreducible elements are ideals. We refer to elements of a poset which are not join-irreducible as \textbf{composite} elements, and the set of join-irreducible elements which joins to them as their \textbf{basis}. It is important to note that if a poset has a globally least element (i.e. element which stands below all other elements in the order relation), that element is not join-irreducible, since it is the join of the empty set. However, if a poset has more than one locally least element (i.e. element with no element below it), then all such elements are join-irreducible. It is also important to note that even if an element is join-irreducible in \(P\), it still may nonetheless become a join in the restriction to \(\Jc(P)\).

A \textbf{downset} of a poset is a set of elements of the poset which is downwardly-closed -- i.e. for which \(x \in S \mathbin{\&\&} y \le x \implies y \in S\). The operation \(\Oc(P)\) sends a poset to the poset of its downsets, ordered by inclusion. Such a poset has meets and joins as respectively intersection and union, and consequently is a distributive lattice. Further, \(\Oc(P)\) is a morphism (and in fact an embedding) of posets, which sends each \(x \in P\) to the set \(\{y \mathbin{|} y \le x\}\).

\textbf{Thm. (Birkhoff)}: When L is a finite distributive lattice, \(\Oc(\Jc(L)))\) is an equivalence, and for any finite poset P,  \(\Jc(\Oc(P)))\) is an equivalence. Further, this equivalence extends to a functorial equivalence between the categories \(FinPos\) and \(FinDLat\), with monotone functions on posets corresponding to homomorphisms of distributive lattices. 

A \textbf{Heyting algebra} is a lattice with a unique top and bottom element, and a special "implication" operation called the \textbf{relative pseudo-complement} (\(a \rightarrow b\)) which yields the unique greatest element \(x\) such that \(a \wedge x \le b\). A \textbf{complete Heyting algebra} is a Heyting algebra such that it is also a complete lattice. The category of complete Heyting algebras takes as morphisms monotone functions which preserve finite meets, arbitrary joins, and implication. 

A \textbf{frame} is a complete Heyting algebra. However, the category \(Frm\) of frames takes as morphisms monotone functions which preserve finite meets and arbitrary joins, but not necessarily implication. This is to say that the relative pseudo-complement operation derived from finite meets and arbitrary joins necessarily exists in frames, but may not commute with any given frame homomorphism. In the finitary case, distributive lattices and complete Heyting algebras coincide, and hence \(FinFrm = FinDLat\).

A \textbf{locale} is again the same thing as a frame. However, in the category \(Loc\) of locales, morphisms are viewed reversed, and hence \(Loc = Frm^{op}\) and \(FinLoc = FinFrm^{op} = FinDLat^{op}\)

A \textbf{nucleus} is the algebraic structure on a frame that gives a sublocale. It given as an monotone function on a frame \(j : L \rightarrow L\), satisfying three properties. First: \(j(a \wedge b) = j(a) \wedge j(b)\). Second, \(a \le j(a)\). Finally, \(j(ja) \le j(a)\). From these it follows that it is contractive (in this case, inflationary) and idempotent. An element of \(L\) is said to be \(j\)-closed if \(j(a)=a\). Further, if \(L\) is a frame, then \(L/j\), which consists only of \(j\)-closed elements, is also a frame, and there exists a surjective frame homomorphism \(j^* : L \rightarrow L/j\). If we view a frame as a category, a nucleus is just a left-exact idempotent monad; if we view a frame as a decategorified topos, a nucleus is a topology; and if we view a frame as generated by its internal logic, a nucleus gives a "possibility" modal operator on that logic.

\subsection{Order-theoretic Characterization}

We would like to consider \(\Oc(\Jc(P)))\) as a morphism of posets for any finite poset \(P\), not necessarily a lattice. An immediate obstacle is that while \(\Oc\) is a morphism of posets, \(\Jc\) is a restriction to a subposet, and hence not a morphism of posets at all. Nonetheless, \(\Jc\) does contain information sufficient to reconstruct all that which is lost in the restriction. This is captured by the following universal property, which flows directly from the definition of \(\Jc\).

\begin{lemma}
If we denote the free join-completion of a poset by \(\Cc(P)\), then \(\Jc(P)\) is the least poset such that \(P \le \Cc(\Jc(P))\)
\end{lemma}


Hence, the composition \(\Oc(\Jc(P)))\) , which we denote \(\Mcc\), is a morphism of posets, by a simple construction. Join-irreducible elements of \(P\) necessarily generate downsets of purely join-irreducible elements, and hence map to those. Composite elements of \(P\) necessarily have a join-irreducible basis. In the composition, they map to the join (i.e. union) of the downsets of this basis. This is to say that each element maps to the set of all join-irreducible elements below it. 

\(\Mcc\) can be given a number of nice universal characterizations, which we will treat in the course of this section. The first is as follows:

\begin{lemma}
\(\Mcc(P)\) is the greatest poset \(Q \ge P\) such that \(\Jc(Q) = \Jc(P)\).
\end{lemma}
\begin{proof}
This unwinds not to be a statement about \(\Mcc\) but simply a statement about \(\Oc(P)\).  Suppose there was a poset greater than \(\Oc(P)\) such that it shared \(P\) as a basis. Then it would need at least one more element. That element could not be join-irreducible, by assumption. If that element was a composite, then it would need to be a join of elements in the basis. But \(\Oc(P)\) already has all joins of elements in the basis.
\end{proof}

\begin{lemma}
\(\Mcc(P)\) is an embedding.
\end{lemma}
\begin{proof}
To establish that no two elements of \(P\) will map to the same element in \(\Mcc(P)\), it suffices to establish that no two elements of a poset share the same basis. But definitionally, no collection of elements can have two least upper bounds.
\end{proof}

\begin{lemma}
\(\Mcc(P)\) is idempotent.
\end{lemma}
\begin{proof}
Since \(\Mcc\) is generated by unions of downsets, it is necessarily a finite distributive lattice. We already know by Birkhoff that in the case of finite distributive lattices this construction is an equivalence.
\end{proof}

\begin{definition}
We say a subset of a poset is \textbf{level-closed} when it is closed under joins for all elements which are not the suprema of a chain within the poset. An \textbf{join-distributive set} is a downward-closed, level-closed subset \(S\) of a poset \(P\) in which for all \(x\) which meet all elements of \(S\) and meet the join of \(S\), \(x \wedge \bigvee(S) = \bigvee(x \wedge S)\).
\end{definition}

\begin{definition}
An \textbf{join-maximal set} is a subset \(S\) of a poset \(P\) for which there is no element \(x \notin S\) such that \(\bigvee(\{x\} \cup S) = \bigvee(S) \mathbin{\&\&} x \neq \bigvee(S)\). A \textbf{maximal join} is the join of a join-maximal set.
\end{definition}

\begin{lemma}
In a poset, any join-maximal set is join-distributive. Furthermore, in a finite meet-semilattice, a set is join-maximal iff it is join-distributive.
\end{lemma}
\begin{proof}


First we show that in any poset, \textit{join-maximal \(\implies\) join-distributive}. For a set \(S\) to fail to be distributive, there must exist some \(x\) whose meet does not distribute over \(S\). Now let \(y = x \wedge \bigvee(S)\). Clearly \(y \leq \bigvee(S)\). When enough meets and joins exist, then when \(x\) is an element of a subposet \(S\), \(x = \bigvee(x \wedge S)\). So, if \(y\) were an element of \(S\) then \(y = \bigvee(y \wedge S) = \bigvee((x \wedge \bigvee(S)) \wedge S)  =  \bigvee(x \wedge (\bigvee(S) \wedge S)) = \bigvee(x \wedge S)\), and so \(x\) would distribute. But if \(y\) is not is \(S\), then there exists an element below \(\bigvee(S)\) which is not in \(S\), and so \(S\) is not join maximal.

Now we show that in any finite meet-semilattice, \textit{join-distributive \(\implies\) join-maximal}. If a set \(S\) is not join-maximal, then there exists some \(x\) below \(\bigvee(S)\) that is not an element of \(S\). Hence, \(x = x \wedge \bigvee(S)\), and if \(S\) is distributive, \(x = \bigvee(x \wedge S)\).  But since \(S\) is level-closed, \(x\) would have to already be an element of \(S\).

%CHECK this argument holds without finiteness?
\end{proof}

Clearly a finite lattice is distributive iff all downsets are distributive. Then, by the above lemma it immediately follows:

\begin{corollary}
A finite lattice is distributive iff all level-closed downsets are join-maximal.
\end{corollary}

By the above results, maximal joins may be seen, in a sense, as the posetal analogue of joins in distributive lattices, or as "distributive joins" in a setting where not all meets and joins necessarily exist. As such, we call a poset morphism that preserves existing meets and maximal joins a \textbf{distributive morphism}.

\begin{lemma}
\(\Mcc(P)\) is an distributive morphism.
\end{lemma}
\begin{proof}

First we consider meets. Given, \(a \wedge b = c\), then we know that under the image of \(\Mcc\) each element maps to the set of of join-irreducibles below it. It follows that join-irreducible elements below \(c\) correspond to the intersection of those below \(a\) and \(b\).

Next, we consider maximal joins.

[PROOF NEEDS TO BE FILLED IN FROM NOTES]
%First we consider joins. In the case of join-irreducible elements, this is immediate, as there are no joins to preserve. In the case of composite elements, for each set \(S\)  which they are the join of, then its basis is necessarily the join of the bases of the elements of x, and hence by construction \(\bigvee(\Mcc(S)) = \Mcc(\bigvee(S)\)), where \(\Mcc(S)\) is the application of \(\Mcc\) to every element of \(S\).

%Next, we consider meets. Meets of join-irreducible elements are themselves join-irreducible, and so exactness is immediate. If an element is the meet of a set \(S\) of composite elements, then its basis is the meet of their bases, and hence \(\bigwedge(\Mcc(S)) = \Mcc(\bigwedge(S)\)).
\end{proof}

%TODO show that M is the same as upside-down-M, aka W.

% Observe that meets of JIs aren't themselves necessarily JI

%TODO examine distributive posets, and "distributive envelopes", for related work.

\begin{lemma}
Every distributive morphism from a finite poset into a distributive lattice \(f : P \rightarrow L\) factors uniquely through \(\Mcc(P)\) followed by a homomorphism of distributive lattices.
\end{lemma}

\begin{proof}
We construct our desired homomorphism, \(g : \Mcc(P) \rightarrow L\) "fiberwise" by showing that at each element of \(\Mcc(P)\) there is a unique choice of where it must land in \(L\). For those elements which are in the image of elements in \(P\), they clearly must map to the same targets in \(L\) as their source in P. For those elements not in the image of elements in \(P\), they must certainly have a basis consisting of the targets of join-irreducible elements in \(P\). Hence, for the homomorphism to preserve joins, they must map to the join of the image of their basis in \(L\). It follows that a so-constructed \(g\) provides a the desired factorization. Furthermore, it follows that any other function either would not yield a factorization, or would not be a distributive lattice homomorphism.
\end{proof}

The above lemmas taken together constitute a proof of the main theorem of this paper:
\begin{theorem}

\(\Mcc\) gives the initial distributive embedding of a poset into a distributive lattice; i.e. the distributive lattice completion of a poset.
\end{theorem}

This constitutes the second universal characterization of \(\Mcc\).

\subsection{Category-theoretic Characterization}

From a category theoretic standpoint, \(\Mcc\) does not give rise in any obvious way to a satisfactory functor from \(FinPos\) to \(FinDLat\). Roughly speaking, this is because there exist monotone functions between distributive lattices which are not distributive lattice homomorphisms (i.e. \(FinPos\) is not a full subcategory of \(FinDLat\)). Nonetheless, we can proceed by restricting our attention to the category \(FinPosMMJ\), which is the subcategory of \(FinPos\) which consists of all posets but only has mmj-morphisms. \(FinPosMMJ\) is a full subcategory of \(FinDLat\), and further it is a reflective subcategory, with \(\Mcc\) as the reflector and the obvious forgetful functor (inclusion) as its right adjoint. 

\begin{theorem}
\(\Mcc : FinPosExact \rightarrow FinDLat \allowbreak  \dashv \allowbreak i : FinDLat \rightarrow FinPosMMJ\).
\end{theorem}

\begin{proof}
We proceed by constructing a direct isomorphism of hom-sets, i.e. showing that \(Hom_{FDL}(\Mcc(X),Y) \allowbreak \simeq \allowbreak Hom_{FPM}(X,i(Y))\). By Birkhoff, morphisms in \(FinDLat\) are in bijection with poset morphisms from the basis of the source to the basis of the target. Similarly, morphisms in \(FinPosMMJ\) which land in distributive lattices are also in bijection with poset morphisms from the basis of the source to the basis of the target. Finally, we observe that for all posets \(P\), by definition \(\Mcc(P)\) shares the same basis. Hence the two sides are in natural bijection.
\end{proof}
This constitutes the third universal characterization of \(\Mcc\), and also suffices to imply the Thm. 3.5. 

 %NOTE: we have to prove this bijection is natural? "everything in sight is natural."

It is tempting to extend this approach back to the entirety of \(FinPos\). For example, consider building \(\Mcc'\)  with action on a morphism \(f : P \rightarrow Q\) generated by first considering only the join-irreducible elements of \(P\), which lift naturally under \(\Mcc'\), and then sending composite elements to the image of their join-irreducible basis, forgetting entirely their original targets. However, such a construction is not functorial. Consider a morphism \(f\) which sends at least some  elements of the basis into join-irreducible elements in the target. We can factor \(f\) into a pair of morphisms -- an injection into some larger object that lands only in composite elements, and then a map into the original target. \(\Mcc'\) of the composition would clearly not be the same as the original lifting. As such, we consider the question of a useful extension of \(\Mcc\) to all of \(FinPos\) an open question. 

%TODO
[IN FACT: can we prove that no such extension exists?]

\subsection{Locale-theoretic characterization}

For any finite poset \(P\), \(\Oc(P)\) can be considered as a frame. (For those familiar with the lingo, it may help to think of this as the "frame of Alexandrov opens of the [opposite of] the poset"). We can use the original poset to construct an idempotent poset endomorphism, \(jdb\), on this frame by the following stepwise procedure. For elements in the image of the basis of \(P\) (i.e. the "double-basis" of \(\Oc(P)\)), \(jdb\) is the identity. Furthermore we impose that for joins of all such elements, \(jdb\) is the identity. And finally, we require that for meets of all elements thus far enumerated, \(jdb\) is the identity. For all other elements, \(jdb\) is the meet of all idempotent elements greater than or equal to it. Since we have explicitly added all necessary meets, the result is necessarily an idempotent.

\begin{lemma}
The poset endomorphism, \(jdb\), generated by the join-meet completion of the join-irreducible elements of the basis of a distributive lattice is a nucleus, which we term the \textbf{double-basis topology}.
\end{lemma}
\begin{proof}
Since \(jdb\) is idempotent by construction and obviously contractive, we only need show it preserves meets; i.e. that that \(jdb(x) \wedge jdb(y) = jdb(x  \wedge  y)\).  If the meet is a meet of idempotents, then it is preserved by construction. If it is not, then it is the meet of elements which themselves are the meets of idempotents. As such, it may be rewritten to be a meet of idempotents, and thus is also preserved.
\end{proof}


\begin{theorem}
\(\Mcc(P)\) may be calculated by the double-basis quotient of \(\Oc(P)\), i.e. \(\Mcc(P) = \Oc(P)/jdb\).
\end{theorem}
\begin{proof}
Clearly \(\Oc(P)/jdb\) contains elements corresponding to all join-irreducible elements in \(P\), and they remain join-irreducible as no elements are added below them. Further, as it is a frame, it is a distributive lattice. It remains to show that it is the least such lattice. The only idempotents which could introduce new join-irreducible elements in the induced basis are the meets of existing elements, of the form  \(z = x \wedge y\). Then \(z = (a \vee b) \wedge (c \vee d)\) for some four elements (possibly overlapping) which are themselves join-irreducible or joins of join-irreducible elements..  By the laws of distributive lattices we may rewrite between disjunctive and conjunctive normal forms and so \(z = \bigvee \{a \wedge c, a \wedge d, b \wedge c, b \wedge d\}\).  But now it is a join of smaller meets. Inductively, either these meets are join-irreducible themselves, or they may be further iteratively decomposed until they are, and therefore the original element is a join of irreducible elements.
\end{proof}
%TODO check carefully.


%NOTE is there a locale/nucleus theoretic universal characterization of M?


% Related: Grothendieck topologies on posets, A.J. Lindenhovious

\section{Dependency Structures with Choice}
We now shift tack entirely and examine a common object in computer science -- a collection of events, each of which is equipped with some predicate regarding other events which must first occur. 

\begin{definition}
A \textbf{Pre-Dependency Structure with Choice} is a pair \((E, D : E \rightarrow \Pc(\Pc(E)))\) where \(E\) is a finite set of events, and \(D\) is a mapping from \(E\) to its double powerset, to be interpreted as mapping each event to a set of alternative dependency requirements -- i.e. to a predicate in disjunctive normal form ranging over variables drawn from \(E\). 
\end{definition}

\begin{definition}
A \textbf{Dependency Structure with Choice} (DSC) is a pre-DSC with \(D\) satisfying  appropriate conditions of transitive closure and cycle-freeness. We define \(X\) as a \textbf{possible dependency set} of \(e\) if \(X \in D(e)\). A pre-DSC is a DSC if for every element \(e'\) in every possible dependency set \(X\) there is a possible dependency set \(Y\) of \(e'\) such that \(Y \subseteq X\), and no possible dependency set of any element contains the element itself. Pre-DSCs may be completed into DSCs by repeatedly taking transitive completion of possible dependency sets (with regards to each transitive possible dependency set) and then deleting cyclic sets until a fixpoint is reached.
\end{definition}

% define complete event set here.
% completeness and reachablility are equivalent.
% define reachable event.


DSCs are richer than the standard notion of a dependency tree or dependency graph. In such structures, a node \(a\) with edges to \(b\) and \(c\) exhibits a dependency on both \(b\) and \(c\). There is no way, however, to express a dependency on either \(b\) or \(c\). A domain-theoretic account of such structures is given by \textit{pomsets}, introduced by Vaughn Pratt. Pomsets are a special instance of a broader class of structures, known as \textit{event structures}, introduced by Nielson, Plotkin and Winskel, and used in the domain-theoretic semantics of concurrent computation and concurrent games. Such structures have not only a (choice-free, transitively normalized) dependency relation, but in addition a conflict structure which indicates incompatible collections of events (typically presented as a collection of consistent sets which carves out only compatible collections of events). Finally, there are so-called \textit{general event structures}, which extend event structures with a notion of choice in roughly the same fashion as DSCs (i.e. by moving from a partial ordering relation into a relation between elements and powersets). Their theory is less well behaved and understood, and its study is an area of ongoing work. Intuitively (i.e. not necessarily formally), in a lattice of expressive power, DSCs sit above pomsets, "side by side" with event structures, and below general event structures.  One hope of the present is work is that it might be usefully extended in some fashion with conflicts, leading among other things to a further understanding of general event structures

While the motivating example of event structures was in understanding things such as Petri nets and communicating sequential processes, our motivating example is in understanding the dependency structure of package collections, either within a language ecosystem, or within, e.g. the package repository for a linux distribution. It is straightforward to see the connection between the two. The installation of a package can be seen as an event, and the packages required to install that package are the event dependencies. Furthermore, some collections of packages may be incompatible, due to conflicts in usage of resources such as global namespace. So while the difference in motivation informs our thinking, the phenomena under examination are very similar from the a sufficient height of abstraction. A further set of examples which the present work sheds modest light on are the special case of dependency structures without choice -- i.e., pomsets -- used in distributed version control systems such as git, and in blockchain-style distributed ledgers.

\begin{definition} The \textbf{reachable dependency poset} of a DSC is the result of an operation, \(rdp\), which sends DSCs to bounded posets (i.e. posets with top and bottom elements) by the following two-step procedure:  We take as elements all collections of events, i.e. \(\Pc(E)\), and impose the least order relation such that one collection of events, \(X\), is above another, \(Y\), if \(Y \subset X\) and for every element of \(X\), there is a possible dependency set contained in \(Y\).  Finally, we restrict ourselves to only those elements of the poset which lie above the empty event set. 
\end{definition}

It follows that for any DSC \((E,D)\), \(rdp((E,D))\)  is a subposet of \(\Pc(E)\), and has all joins (i.e. unions). Viewed as a graph, nodes of a reachable dependency poset correspond to sets of events which are complete (i.e. for which each event in the set we can find other events in the set which satisfy one of its possible dependency sets), and edges correspond to linear accretion of event sets over time by addition of subsequent events. Consequently, a reachable dependency poset may also be seen as generated by considering all possible dependency sets of all events, augmenting each with the event itself, and then, under the inclusion ordering, augmenting the result with the empty set and in addition all possible joins. Intuitively, a reachable dependency set is generated by asking "for each event, what are the basic (reachable) event sets which contain it," and then completing those by the empty set and all unions of this basis.

Intuitively, this looks similar to a topological space, with events as points, and reachable event sets as open covers. However, for a topological space, not only must the union of opens remain open (as is the case with reachable event sets), but the intersection of opens must also be open. Consider an event \(a\), which depends on either \(b\) or \(c\). \(\{a,b\}\) and  \(\{a,c\}\) are reachable event sets, but their intersection, \(\{a\}\), is not.

To the vaguely formed question "how do we make reachable dependency posets topological" we propose a precise answer: application of the idempotent distributive lattice completion. This is to say, we take the composite \(\Mcc(rdp(E,D))\). As already discussed, the irreducible elements of a reachable dependency poset are those sets which are generated by the possible dependency sets of individual events -- i.e. that have an event which is shared by no complete dependency set below them. In the above example, the irreducible elements, i.e. \(\Oc(rdp(E,D))\), are \(\{b\}\), \(\{c\}\), \(\{a,b\}\), and \(\{a,c\}\). Hence the application of \(\Jc\) yields the four sets \(\{\{b\}\}\), \(\{\{c\}\}\), \(\{\{b\},\{a,b\}\}\), and \(\{\{c\},\{a,c\}\}\), but also \(\{\}\), \(\{\{b\},\{c\},\{b,c\}\}\) and \(\{\{b\},\{c\},\{a,b\},\{a,c\}\}\). (see figure n.)


%TODO add illustration


Informally speaking, for every event which has multiple "paths" to enable it (i.e. multiple possible dependency sets), we split the event into new events, each labeled by a different possible dependency set. And since branched events may depend on other branched events, we do so recursively. In the resulting structure, rather than sets of events, we have sets of events each labeled by the "path" we took to get to them. From the standpoint of package management, not only does this make perfect sense, but it captures additional useful information. Library \(a\) may link against library \(b\) or \(c\), each of which provide the same API-surface, but which have subtle differences in behavior. So while \(a\) depends "equally" on either \(b\) or \(c\), the resulting products, \(a_b\) and \(a_c\) are not guaranteed to be the same thing. It is precisely this distinction which is captured by taking the idempotent distributive lattice completion.

\textbf{Aside}: In the above subscript "shorthand", every node becomes a single event, labeled by the set of (labeled) events below it, and soforth. In any nontrivial chain, one then gets subscripts of subscripts of subscripts. Representing this computationally seems a bit of a chore. If we took each label and turned it into a hash, and then when taking sets of labels instead took hashes of their hashes, etc, then (with high probability) we could represent the same information in constant space rather than space geometric in the height of our poset. This structure, with nodes recursively labeled by the hashes of the nodes below them, such that all "path" information is, to high probability, represented in a single hash at each node, is precisely what is known in computer science as a \textbf{Merkle tree}. The idempotent distributive lattice completion, \(\Mcc\) is then, in a sense, the \textit{non-probabilistic Merkle transformation} of a poset, and provides a formal description of what it means when we take an existing data structure and "turn it into a Merkle tree."

% merkle used in dist db, dvcs like git, blockchain





% can we view our thing as a way to turn a poset into a category?

%TODO motivating examples/pictures.



% maps in the categories of DSCs? i.e. dsc morphisms/homomorphisms/embeddings?

% Event structure relation suggested by Jonas Frey

% TODO describe normalization procedure and relationship to event structures

% Complexity in of reachability of an event in a general event structure (i.e. if it exists in a configuration) is np complete -- hence difficulty.
% i.e. the logical structure of a DSC's reachable poset as a presentation of satisfiability.

%Winskel, Glynn (1987). "Event Structures""
% Joyal, Nielson, Winskel, "Bisimulation from Open Maps"
% Domains and Event Structures for Fusions, Paolo Baldan -- closely related!
% https://arxiv.org/pdf/1802.03726.pdf -- EVENT STRUCTURES FOR PETRI NETS WITH PERSISTENCE
% "The idea is that, if in a general event structure an event has conflicting classes of causal histories, then it should split in several copies when generating the corresponding connected event structure." different result but same insight.

% A Grothendieck topology is considered subcanonical if all representable presheaves are sheaves. Similarly, a nucleus is considered subcanonical if... actually this only works if we produce a posite topology directly.

% general event structures -- chapter 16: https://www.cl.cam.ac.uk/~gw104/ecsym-notes.pdf

% Mention alexandrov opens?

% Does FinPosExact correspond to topological spaces more than FinPos does!?



%\section{}
%\subsection{}

\begin{comment}

\section{Unrelated matter}

\textbf{Thm. (Å eÅ¡elja, TepavÄeviÄ)}: For any distributive lattice, \(L\), there is a unique poset, which we denote \(\Wc(L)\) that is the smallest poset such that \(\Jc(\Wc(L)) = \Jc(L)\). The formula for this is \(\Wc(L) = \Jc(L) \cup \{y \in L \mathbin{|} y = \bigwedge S, S \in SupCover(\Jc(L))\}\), where \(SupCover\) sends a poset to a set of elements by  first considering only the elements which are suprema of all elements below them, and for each supremum picking out the set of elements strictly beneath it. Further, the set of all sublattices of \(L\) which have the same join-irreducibles as \(L\) is identical to the set of all subposets of \(L\) which contain \(\Wc(L)\) as a subposet.

% full citation On generation of finite posets by meet-irreducibles (Branimir Å eÅ¡elja, Andreja TepavÄeviÄ)
% it is proved that every finite partially ordered set with a given poset of meet-irreducibles is order-embeddable into the corresponding finite distributive lattice.

An intuition for \(\Wc\) is that we certainly need the join-irreducibles within it. And furthermore, for each candidate element which could be eliminated by a further application of \(\Jc\) (i.e. an element which sits in \(\Jc(L)\) as the join of two other join-irreducibles) we need to ensure we have added an element which prevents this, by serving as the "actual" join of the elements which sit below it.

We observe that \(\Wc\), induces a functor \(FinDLat \rightarrow FinPos\). The action on homomorphisms can be understood in two steps. Join-irreducible elements necessarily map to join-irreducible elements, and so are obtained directly by restriction. If a composite element exists, it must do so because it is the direct join of join-irreducible elements that live immediately below a supremum. Because distributive lattice homomorphisms preserve such suprema, and preserve joins, then the target of any composite element in the image of \(\Wc\) in the source of the homomorphism must necessarily also be in the image of \(Wc\) in the target of the homomorphism. As such, the remainder of the action on homomorphisms can also be obtained by restriction.

As a side remark, the construction \(\Wc\) in fact works not just for distributive lattices, but for all posets. However, in this case, it is not so clear how to extend it to a satisfactory functor.
\end{comment}


\end{document}  